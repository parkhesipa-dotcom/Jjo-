-----------------------------------------------------------
# ðŸ”¹ Step 9 â€“ Decrypt the RBI response (lrsResponse)
# -----------------------------------------------------------
try:
    resp_json = response.json()
    encrypted_lrs = resp_json["body"]["lrsoutput"]["lrsResponse"]
    decrypted_lrs = aes_gcm_decrypt(encrypted_lrs, aes_key_for_encryption)

    print("\nâœ… Decrypted LRS Response:")
    print(decrypted_lrs)

except Exception as e:
    print("\nâš ï¸ Decryption failed or invalid response format:", e)







def aes_gcm_decrypt(encrypted_b64: str, key: bytes) -> str:
    decoded_data = base64.b64decode(encrypted_b64)
    iv = decoded_data[:IV_SIZE]
    ciphertext = decoded_data[IV_SIZE:-TAG_SIZE]
    tag = decoded_data[-TAG_SIZE:]
    cipher = AES.new(key, AES.MODE_GCM, nonce=iv)
    decrypted = cipher.decrypt_and_verify(ciphertext, tag)
    return decrypted.decode("utf-8")


