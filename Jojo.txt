from flask import request
from flask_restful import Resource
from pydantic import ValidationError
from models.lrs_model import LRSRequest
from services.lrs_service import build_lrs_payload


class LRSVerification(Resource):
    def post(self):
        try:
            # Parse and validate input
            data = request.get_json()
            validated = LRSRequest(**data)

            # Generate encrypted LRS payload
            final_body = build_lrs_payload(validated.pan, validated.uniqueId)

            return final_body, 200

        except ValidationError as e:
            return {"error": e.errors()}, 400

        except Exception as e:
            return {"error": str(e)}, 500










from pydantic import BaseModel, Field, constr

class LRSRequest(BaseModel):
    pan: constr(
        min_length=10,
        max_length=10,
        pattern=r'^[A-Z]{5}\d{4}[A-Z]$'
    ) = Field(
        ...,
        description="PAN number (exactly 10 characters, valid format: 5 letters, 4 digits, 1 letter)"
    )

    uniqueId: str = Field(..., description="Unique identifier for the request")

